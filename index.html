<!DOCTYPE html>  
<html>  
<head>  
  <meta charset="UTF-8">  
  <title>Réinitialisation Mot de Passe</title>  
  <style>  
    body {  
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;  
      max-width: 600px;  
      margin: 50px auto;  
      padding: 20px;  
    }  
    .form-group {  
      margin-bottom: 20px;  
    }  
    label {  
      display: block;  
      margin-bottom: 5px;  
      font-weight: 600;  
    }  
    input {  
      width: 100%;  
      padding: 10px;  
      border: 1px solid #ccc;  
      border-radius: 4px;  
      font-size: 14px;  
      box-sizing: border-box;  
    }  
    button {  
      background-color: #0078d4;  
      color: white;  
      padding: 12px 30px;  
      border: none;  
      border-radius: 4px;  
      font-size: 16px;  
      cursor: pointer;  
      font-weight: 600;  
    }  
    button:hover {  
      background-color: #005a9e;  
    }  
    #message {  
      margin-top: 20px;  
      padding: 15px;  
      border-radius: 4px;  
      display: none;  
    }  
  </style>  
</head>  
<body>  
&nbsp;  
  <h2>Réinitialisation de mot de passe</h2>  
  <p>Remplissez le formulaire ci-dessous :</p>  
&nbsp;  
  <div class="form-group">  
    <label>Votre login professionnel :</label>  
    <input type="text" id="userPrincipalName" placeholder="exemple@fnaim.fr" />  
  </div>  
    
  <div class="form-group">  
    <label>Votre email personnel :</label>  
    <input type="text" id="emailToVerify" placeholder="votre.email@gmail.com" />  
  </div>  
    
  <button onclick="resetPassword()">Réinitialiser mon mot de passe</button>  
    
  <div id="message"></div>  
&nbsp;  
<script>  
function resetPassword() {  
  var upn = document.getElementById('userPrincipalName').value;  
  var email = document.getElementById('emailToVerify').value;  
  var messageDiv = document.getElementById('message');  
    
  if (!upn || !email) {  
    messageDiv.style.display = 'block';  
    messageDiv.style.backgroundColor = '#fff4ce';  
    messageDiv.style.border = '1px solid #faebcc';  
    messageDiv.style.color = '#8a6d3b';  
    messageDiv.innerHTML = 'Veuillez remplir votre login professionnel ET votre email personnel.';  
    return;  
  }  
    
  if (!upn.includes('@') || !email.includes('@')) {  
    messageDiv.style.display = 'block';  
    messageDiv.style.backgroundColor = '#fff4ce';  
    messageDiv.style.border = '1px solid #faebcc';  
    messageDiv.style.color = '#8a6d3b';  
    messageDiv.innerHTML = 'Vérifiez que vous avez bien saisi des adresses email complètes.';  
    return;  
  }  
    
  messageDiv.style.display = 'block';  
  messageDiv.style.backgroundColor = '#d9edf7';  
  messageDiv.style.border = '1px solid #bce8f1';  
  messageDiv.style.color = '#31708f';  
  messageDiv.innerHTML = 'Traitement en cours...';  
    
  var data = {  
    userPrincipalName: upn,  
    emailToVerify: email,  
    demandeur: upn  
  };  
    
  fetch('https://prod-28.francecentral.logic.azure.com:443/workflows/5c80bda224074c59a4e334dfefc14658/triggers/When_an_HTTP_request_is_received/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2FWhen_an_HTTP_request_is_received%2Frun&sv=1.0&sig=3tbZ6k5DadPUJoffJB1L8D80BLy7PrYow2GVRsrghVU', {  
    method: 'POST',  
    headers: { 'Content-Type': 'application/json' },  
    body: JSON.stringify(data)  
  })  
  .then(function(response) {  
    if (!response.ok) {  
      if (response.status === 403) {  
        throw new Error('NON_AUTORISE');  
      } else if (response.status === 400) {  
        throw new Error('EMAIL_INVALIDE');  
      } else {  
        throw new Error('ERREUR_SERVEUR');  
      }  
    }  
    return response.json();  
  })  
  .then(function(result) {  
    messageDiv.style.backgroundColor = '#dff0d8';  
    messageDiv.style.border = '1px solid #d6e9c6';  
    messageDiv.style.color = '#3c763d';  
    messageDiv.innerHTML = 'Mot de passe réinitialisé avec succès ! Vous allez recevoir un email à ' + email + ' avec votre nouveau mot de passe temporaire.';  
  })  
  .catch(function(error) {  
    if (error.message === 'NON_AUTORISE') {  
      messageDiv.style.backgroundColor = '#f2dede';  
      messageDiv.style.border = '1px solid #ebccd1';  
      messageDiv.style.color = '#a94442';  
      messageDiv.innerHTML = 'Accès refusé : Votre compte n est pas autorisé à utiliser ce service. Contactez le support IT.';  
    } else if (error.message === 'EMAIL_INVALIDE') {  
      messageDiv.style.backgroundColor = '#f2dede';  
      messageDiv.style.border = '1px solid #ebccd1';  
      messageDiv.style.color = '#a94442';  
      messageDiv.innerHTML = 'Email de récupération incorrect : L adresse ne correspond pas à celle enregistrée.';  
    } else {  
      messageDiv.style.backgroundColor = '#f2dede';  
      messageDiv.style.border = '1px solid #ebccd1';  
      messageDiv.style.color = '#a94442';  
      messageDiv.innerHTML = 'Erreur : Vérifiez votre login professionnel et votre email personnel. Si le problème persiste, contactez le support IT.';  
    }  
  });  
}  
</script>  
&nbsp;  
</body>  
</html>  
